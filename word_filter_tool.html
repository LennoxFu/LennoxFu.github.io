<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>单词筛选工具</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      text-align: center;
      max-width: 600px;
      width: 100%;
      position: relative;
      overflow: hidden;
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
      border-radius: 24px 24px 0 0;
    }

    h1 {
      color: #2d3748;
      font-size: 2.5em;
      font-weight: 700;
      margin-bottom: 40px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .upload-section {
      background: #f7fafc;
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      border: 2px dashed #cbd5e0;
      transition: all 0.3s ease;
    }

    .upload-section:hover {
      border-color: #667eea;
      background: #f1f5f9;
    }

    .upload-section.dragover {
      border-color: #4facfe;
      background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1));
    }

    .file-input-wrapper {
      position: relative;
      display: inline-block;
      margin: 20px 0;
    }

    .file-input {
      opacity: 0;
      position: absolute;
      z-index: -1;
    }

    .file-input-label {
      display: inline-block;
      padding: 16px 32px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .file-input-label:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .file-info {
      margin-top: 15px;
      padding: 12px;
      background: white;
      border-radius: 8px;
      color: #4a5568;
      font-weight: 500;
    }

    .word-count-info {
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: white;
      padding: 12px 20px;
      border-radius: 20px;
      display: inline-block;
      margin: 15px 0;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
    }

    .options-section {
      background: #f7fafc;
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid #e2e8f0;
    }

    .options-section h4 {
      color: #2d3748;
      margin-bottom: 15px;
      font-size: 1.1em;
    }

    .checkbox-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }

    .checkbox-wrapper input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #667eea;
    }

    .checkbox-wrapper label {
      color: #4a5568;
      font-weight: 500;
      cursor: pointer;
    }

    .word-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 40px 20px;
      margin: 30px 0;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      min-height: 160px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      transition: all 0.3s ease;
      position: relative;
    }

    .word-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    #word {
      font-size: 3em;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 10px;
      letter-spacing: 1px;
      transition: all 0.4s ease;
    }

    #word.highlight {
      transform: scale(1.1);
      color: #667eea;
    }

    #meaning {
      font-size: 1.3em;
      color: #718096;
      font-weight: 500;
      margin-top: 15px;
      opacity: 0.9;
    }

    .timer-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 4px;
      background: linear-gradient(90deg, #ff6b6b, #feca57);
      border-radius: 0 0 16px 16px;
      width: 100%;
      transition: width 5s linear;
    }

    .buttons-container {
      margin: 40px 0;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: center;
    }

    button {
      padding: 16px 32px;
      font-size: 1.1em;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      color: white;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
      min-width: 120px;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.6s;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    button:active {
      transform: translateY(-1px);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    .start-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      font-size: 1.2em;
      padding: 18px 36px;
    }

    .shuffle-btn {
      background: linear-gradient(135deg, #ff9a9e, #fecfef);
      color: #333;
      font-size: 1em;
      padding: 12px 24px;
      margin: 10px;
    }

    .export-btn {
      background: linear-gradient(135deg, #a8edea, #fed6e3);
      color: #333;
      font-size: 1em;
      padding: 12px 24px;
      margin: 10px;
    }

    .familiar {
      background: linear-gradient(135deg, #4facfe, #00f2fe);
    }

    .unfamiliar {
      background: linear-gradient(135deg, #f093fb, #f5576c);
    }

    .vague {
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      color: #333;
    }

    .match {
      background: linear-gradient(135deg, #a8edea, #fed6e3);
      color: #333;
    }

    .diff {
      background: linear-gradient(135deg, #d299c2, #fef9d7);
      color: #333;
    }

    .round-indicator {
      position: absolute;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: 600;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(102, 126, 234, 0.2);
      border-radius: 4px;
      margin: 20px 0;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4facfe, #00f2fe);
      border-radius: 4px;
      transition: width 0.3s ease;
      width: 0%;
    }

    #result {
      margin-top: 30px;
      text-align: left;
      background: #f7fafc;
      border-radius: 16px;
      padding: 30px;
      box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    #result h3 {
      color: #2d3748;
      margin-bottom: 20px;
      font-size: 1.5em;
      text-align: center;
    }

    #result p {
      margin: 15px 0;
      padding: 12px 16px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid;
      font-size: 1.1em;
      line-height: 1.6;
    }

    #result p:nth-child(2) { border-left-color: #4facfe; }
    #result p:nth-child(3) { border-left-color: #f093fb; }
    #result p:nth-child(4) { border-left-color: #a8edea; }
    #result p:nth-child(5) { border-left-color: #d299c2; }

    .word-count {
      display: inline-block;
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.9em;
      font-weight: 600;
      margin-left: 10px;
    }

    .celebration {
      animation: celebration 0.6s ease-out;
    }

    @keyframes celebration {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .error-message {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      margin: 15px 0;
      font-weight: 500;
    }

    .success-message {
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      margin: 15px 0;
      font-weight: 500;
    }

    .excel-format-info {
      background: #e2e8f0;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      font-size: 0.95em;
      color: #4a5568;
      text-align: left;
    }

    .excel-format-info h4 {
      color: #2d3748;
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .shuffle-indicator {
      background: linear-gradient(135deg, #ff9a9e, #fecfef);
      color: #333;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: 600;
      margin: 10px 0;
      display: inline-block;
    }

    @media (max-width: 768px) {
      .container {
        padding: 30px 20px;
        margin: 10px;
      }
      
      h1 {
        font-size: 2em;
        margin-bottom: 30px;
      }
      
      #word {
        font-size: 2.2em;
      }
      
      .buttons-container {
        flex-direction: column;
        align-items: center;
      }
      
      button {
        width: 100%;
        max-width: 250px;
      }

      .upload-section {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container fade-in">
    <div class="round-indicator" id="roundIndicator" style="display: none;">第1轮</div>
    <h1>🎯 单词筛选工具</h1>

    <!-- 文件上传区域 -->
    <div class="upload-section" id="uploadSection">
      <h3 style="color: #4a5568; margin-bottom: 20px;">📁 上传你的单词列表</h3>
      
      <div class="file-input-wrapper">
        <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" onchange="handleFile(event)">
        <label for="fileInput" class="file-input-label">
          📤 选择Excel文件
        </label>
      </div>
      
      <div class="excel-format-info">
        <h4>📋 Excel文件格式要求：</h4>
        <p>• 第一列：英语单词 (如：abandon, abstract, ...)</p>
        <p>• 第二列：中文释义 (如：放弃, 抽象的, ...)</p>
        <p>• 支持 .xlsx 和 .xls 格式</p>
        <p>• 第一行可以是标题行，程序会自动识别</p>
      </div>
      
      <div id="fileInfo" class="file-info" style="display: none;"></div>
      <div id="wordCountInfo" class="word-count-info" style="display: none;"></div>
      <div id="uploadMessage"></div>
      
      <!-- 测试选项 -->
      <div class="options-section">
        <h4>⚙️ 测试选项</h4>
        <div class="checkbox-wrapper">
          <input type="checkbox" id="shuffleOption" checked>
          <label for="shuffleOption">🔀 随机打乱单词顺序</label>
        </div>
      </div>
    </div>

    <div class="progress-bar" style="display: none;">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <div id="shuffleIndicator" class="shuffle-indicator" style="display: none;">
      🔀 单词顺序已随机打乱
    </div>

    <div class="word-card" style="display: none;">
      <div id="word">点击开始测试</div>
      <div id="meaning"></div>
      <div class="timer-bar" id="timerBar"></div>
    </div>

    <div class="buttons-container">
      <button class="start-btn" onclick="start()" id="startBtn" disabled>🚀 开始测试</button>
      <button class="familiar" onclick="classify('familiar')" style="display: none;">✅ 熟悉</button>
      <button class="unfamiliar" onclick="classify('unfamiliar')" style="display: none;">❌ 不熟</button>
      <button class="vague" onclick="classify('vague')" style="display: none;">❓ 模糊</button>
      <button class="match" onclick="classify('match')" style="display:none;">✅ 模糊但匹配</button>
      <button class="diff" onclick="classify('diff')" style="display:none;">❌ 模糊且差异</button>
    </div>

    <div id="result"></div>
  </div>

  <!-- 引入 SheetJS 库 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    // 默认单词列表（作为示例）
    const defaultWords = [
      {en:"abandon", zh:"放弃"},
      {en:"abstract", zh:"抽象的"},
      {en:"accelerate", zh:"加速"},
      {en:"accessible", zh:"可接近的"},
      {en:"accompany", zh:"陪伴"},
      {en:"accomplish", zh:"完成"},
      {en:"account", zh:"账户；解释"},
      {en:"accumulate", zh:"积累"},
      {en:"accurate", zh:"准确的"},
      {en:"accuse", zh:"指控"}
    ];

    let words = []; // 当前使用的单词列表
    let originalWords = []; // 保存原始单词列表
    let familiar = [], unfamiliar = [], vague = [], vagueMatch = [], vagueDiff = [];
    let index = 0, round = 1, timer;

    // 随机打乱数组的函数
    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    // 拖拽上传功能
    const uploadSection = document.getElementById('uploadSection');
    uploadSection.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadSection.classList.add('dragover');
    });

    uploadSection.addEventListener('dragleave', (e) => {
      e.preventDefault();
      uploadSection.classList.remove('dragover');
    });

    uploadSection.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadSection.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        const file = files[0];
        if (file.name.match(/\.(xlsx|xls)$/i)) {
          processExcelFile(file);
        } else {
          showMessage('请上传Excel文件 (.xlsx 或 .xls)', 'error');
        }
      }
    });

    function handleFile(event) {
      const file = event.target.files[0];
      if (file) {
        processExcelFile(file);
      }
    }

    function processExcelFile(file) {
      showMessage('正在解析Excel文件...', 'info');
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          
          // 读取第一个工作表
          const sheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[sheetName];
          const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
          
          // 解析数据
          const parsedWords = parseWordsFromExcel(jsonData);
          
          if (parsedWords.length === 0) {
            showMessage('Excel文件中没有找到有效的单词数据', 'error');
            return;
          }
          
          originalWords = parsedWords;
          words = [...originalWords];
          
          // 显示文件信息
          document.getElementById('fileInfo').style.display = 'block';
          document.getElementById('fileInfo').innerHTML = `✅ 文件已上传：${file.name}`;
          
          document.getElementById('wordCountInfo').style.display = 'block';
          document.getElementById('wordCountInfo').innerHTML = `📚 共加载 ${words.length} 个单词`;
          
          // 启用开始按钮
          document.getElementById('startBtn').disabled = false;
          
          showMessage('Excel文件解析成功！', 'success');
          
        } catch (error) {
          console.error('Excel解析错误:', error);
          showMessage('Excel文件解析失败，请检查文件格式', 'error');
        }
      };
      
      reader.readAsArrayBuffer(file);
    }

    function parseWordsFromExcel(jsonData) {
      const parsedWords = [];
      let startRow = 0;
      
      // 检查第一行是否为标题行
      if (jsonData.length > 0) {
        const firstRow = jsonData[0];
        if (firstRow && firstRow.length >= 2) {
          // 如果第一行看起来像标题，就跳过它
          const firstCellStr = String(firstRow[0]).toLowerCase();
          const secondCellStr = String(firstRow[1]).toLowerCase();
          if (firstCellStr.includes('英') || firstCellStr.includes('english') || firstCellStr.includes('word') ||
              secondCellStr.includes('中') || secondCellStr.includes('chinese') || secondCellStr.includes('意思')) {
            startRow = 1;
          }
        }
      }
      
      // 解析数据行
      for (let i = startRow; i < jsonData.length; i++) {
        const row = jsonData[i];
        if (row && row.length >= 2 && row[0] && row[1]) {
          const en = String(row[0]).trim();
          const zh = String(row[1]).trim();
          
          // 验证英语单词格式（基本的字母检查）
          if (en && zh && /^[a-zA-Z\s\-\.]+$/.test(en)) {
            parsedWords.push({ en, zh });
          }
        }
      }
      
      return parsedWords;
    }

    function showMessage(text, type = 'info') {
      const messageDiv = document.getElementById('uploadMessage');
      let className = 'success-message';
      
      if (type === 'error') {
        className = 'error-message';
      } else if (type === 'info') {
        className = 'success-message';
      }
      
      messageDiv.innerHTML = `<div class="${className}">${text}</div>`;
      
      // 3秒后清除消息
      setTimeout(() => {
        messageDiv.innerHTML = '';
      }, 3000);
    }

    function start() {
      if (words.length === 0) {
        showMessage('请先上传Excel文件或使用默认单词列表', 'error');
        return;
      }
      
      // 检查是否需要随机打乱
      if (document.getElementById('shuffleOption').checked) {
        words = shuffleArray(originalWords.length > 0 ? originalWords : defaultWords);
        document.getElementById('shuffleIndicator').style.display = 'block';
      } else {
        words = [...(originalWords.length > 0 ? originalWords : defaultWords)];
        document.getElementById('shuffleIndicator').style.display = 'none';
      }
      
      index = 0; round = 1;
      familiar = []; unfamiliar = []; vague = []; vagueMatch = []; vagueDiff = [];
      document.getElementById("result").innerHTML = "";
      document.getElementById("roundIndicator").innerText = "第1轮";
      document.getElementById("roundIndicator").style.display = "block";
      
      // 隐藏上传区域，显示测试区域
      document.getElementById('uploadSection').style.display = 'none';
      document.querySelector('.word-card').style.display = 'flex';
      document.querySelector('.progress-bar').style.display = 'block';
      
      updateProgress();
      showWord();
    }

    function updateProgress() {
      const totalWords = round === 1 ? words.length : vague.length;
      const progress = totalWords > 0 ? (index / totalWords) * 100 : 0;
      document.getElementById("progressFill").style.width = progress + "%";
    }

    function resetTimerBar() {
      const timerBar = document.getElementById("timerBar");
      // 立即设置为100%宽度，无动画
      timerBar.style.transition = 'none';
      timerBar.style.width = '100%';
      // 强制浏览器重绘
      timerBar.offsetHeight;
    }

    function startTimerBar() {
      const timerBar = document.getElementById("timerBar");
      // 在下一帧开始动画
      requestAnimationFrame(() => {
        timerBar.style.transition = 'width 5s linear';
        timerBar.style.width = '0%';
      });
    }

    function showWord() {
      clearTimeout(timer);
      resetTimerBar(); // 重置计时器条
      
      if (round === 1 && index >= words.length) {
        // 第一轮结束，进入第二轮复盘
        index = 0; round = 2;
        document.getElementById("roundIndicator").innerText = "第2轮";
        if (vague.length === 0) {
          finish();
          return;
        }
        document.getElementById("word").innerText = "🔄 进入模糊单词复盘";
        document.getElementById("word").classList.add("highlight");
        setTimeout(() => {
          document.getElementById("word").classList.remove("highlight");
          showWord();
        }, 1500);
        return;
      }
      
      if (round === 2 && index >= vague.length) {
        finish();
        return;
      }

      let wordObj = (round === 1 ? words[index] : vague[index]);
      document.getElementById("word").innerText = wordObj.en;
      document.getElementById("meaning").innerText = (round === 2 ? wordObj.zh : "");
      
      // 控制按钮显示
      document.querySelectorAll(".familiar,.unfamiliar,.vague").forEach(b => 
        b.style.display = (round === 1 ? "inline-block" : "none")
      );
      document.querySelectorAll(".match,.diff").forEach(b => 
        b.style.display = (round === 2 ? "inline-block" : "none")
      );
      document.querySelector(".start-btn").style.display = "none";
      
      updateProgress();

      if (round === 1) {
        // 启动5秒计时器条动画
        startTimerBar();
        timer = setTimeout(() => classify('vague'), 5000);
      }
    }

    function classify(type) {
      clearTimeout(timer);
      resetTimerBar(); // 立即重置计时器条
      
      let wordObj = (round === 1 ? words[index] : vague[index]);

      if (round === 1) {
        if (type === 'familiar') familiar.push(wordObj);
        else if (type === 'unfamiliar') unfamiliar.push(wordObj);
        else if (type === 'vague') vague.push(wordObj);
      } else {
        if (type === 'match') vagueMatch.push(wordObj);
        else if (type === 'diff') vagueDiff.push(wordObj);
      }

      // 添加点击反馈动画
      document.querySelector(".word-card").classList.add("celebration");
      setTimeout(() => {
        document.querySelector(".word-card").classList.remove("celebration");
      }, 600);

      index++;
      setTimeout(showWord, 300);
    }

    // 导出结果到Excel
    function exportResults() {
      if (familiar.length === 0 && unfamiliar.length === 0 && vagueMatch.length === 0 && vagueDiff.length === 0) {
        showMessage('没有可导出的结果', 'error');
        return;
      }

      try {
        // 创建工作簿
        const wb = XLSX.utils.book_new();
        
        // 创建汇总工作表
        const summaryData = [
          ['分类', '单词数量', '单词列表'],
          ['熟悉单词', familiar.length, familiar.map(w => w.en).join(', ')],
          ['不熟单词', unfamiliar.length, unfamiliar.map(w => w.en).join(', ')],
          ['模糊-匹配', vagueMatch.length, vagueMatch.map(w => w.en).join(', ')],
          ['模糊-差异', vagueDiff.length, vagueDiff.map(w => w.en).join(', ')]
        ];
        const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);
        XLSX.utils.book_append_sheet(wb, summaryWs, '筛选汇总');

        // 创建详细分类工作表
        const categories = [
          { name: '熟悉单词', data: familiar, sheetName: '熟悉单词' },
          { name: '不熟单词', data: unfamiliar, sheetName: '不熟单词' },
          { name: '模糊-匹配', data: vagueMatch, sheetName: '模糊匹配' },
          { name: '模糊-差异', data: vagueDiff, sheetName: '模糊差异' }
        ];

        categories.forEach(category => {
          if (category.data.length > 0) {
            const categoryData = [['英语单词', '中文释义']];
            category.data.forEach(word => {
              categoryData.push([word.en, word.zh]);
            });
            const categoryWs = XLSX.utils.aoa_to_sheet(categoryData);
            XLSX.utils.book_append_sheet(wb, categoryWs, category.sheetName);
          }
        });

        // 生成文件名（包含时间戳）
        const now = new Date();
        const timestamp = now.toISOString().slice(0, 19).replace(/:/g, '-');
        const filename = `单词筛选结果_${timestamp}.xlsx`;

        // 下载文件
        XLSX.writeFile(wb, filename);
        
        showMessage('结果已成功导出到Excel文件！', 'success');
        
      } catch (error) {
        console.error('导出错误:', error);
        showMessage('导出失败，请重试', 'error');
      }
    }

    function finish() {
      document.getElementById("word").innerText = "🎉 筛选完成！";
      document.getElementById("meaning").innerText = "";
      document.getElementById("roundIndicator").style.display = "none";
      document.getElementById("shuffleIndicator").style.display = "none";
      document.querySelectorAll("button").forEach(b => b.style.display = "none");
      document.querySelector(".progress-bar").style.display = "none";
      resetTimerBar(); // 确保计时器条被重置
      
      let resultHTML = "<h3>📊 结果统计</h3>";
      resultHTML += `<p><strong>✅ 熟悉单词:</strong> ${familiar.map(w=>w.en).join(", ")} <span class="word-count">${familiar.length}个</span></p>`;
      resultHTML += `<p><strong>❌ 不熟单词:</strong> ${unfamiliar.map(w=>w.en).join(", ")} <span class="word-count">${unfamiliar.length}个</span></p>`;
      resultHTML += `<p><strong>✅ 模糊-匹配:</strong> ${vagueMatch.map(w=>w.en).join(", ")} <span class="word-count">${vagueMatch.length}个</span></p>`;
      resultHTML += `<p><strong>❌ 模糊-差异:</strong> ${vagueDiff.map(w=>w.en).join(", ")} <span class="word-count">${vagueDiff.length}个</span></p>`;
      
      // 添加导出和重新开始按钮
      resultHTML += `<div style="text-align: center; margin-top: 30px;">
        <button class="export-btn" onclick="exportResults()" style="display: inline-block;">📥 导出结果</button>
        <button class="start-btn" onclick="resetToUpload()" style="display: inline-block;">🔄 重新开始</button>
      </div>`;
      
      document.getElementById("result").innerHTML = resultHTML;
      document.getElementById("result").classList.add("fade-in");
    }

    function resetToUpload() {
      // 重置所有状态
      words = [];
      originalWords = [];
      familiar = []; unfamiliar = []; vague = []; vagueMatch = []; vagueDiff = [];
      index = 0; round = 1;
      clearTimeout(timer);
      resetTimerBar();
      
      // 显示上传区域，隐藏其他区域
      document.getElementById('uploadSection').style.display = 'block';
      document.querySelector('.word-card').style.display = 'none';
      document.querySelector('.progress-bar').style.display = 'none';
      document.getElementById("result").innerHTML = "";
      document.getElementById("roundIndicator").style.display = "none";
      document.getElementById("shuffleIndicator").style.display = "none";
      
      // 重置按钮显示
      document.querySelector(".start-btn").style.display = "inline-block";
      document.querySelector(".start-btn").disabled = true;
      document.querySelectorAll(".familiar,.unfamiliar,.vague,.match,.diff").forEach(b => 
        b.style.display = "none"
      );
      
      // 清空文件信息
      document.getElementById('fileInfo').style.display = 'none';
      document.getElementById('wordCountInfo').style.display = 'none';
      document.getElementById('fileInput').value = '';
      
      // 重置复选框
      document.getElementById('shuffleOption').checked = true;
    }

    // 页面加载时使用默认单词列表作为示例
    window.onload = function() {
      originalWords = [...defaultWords];
      words = [...defaultWords];
      document.getElementById('wordCountInfo').style.display = 'block';
      document.getElementById('wordCountInfo').innerHTML = `📚 当前使用示例单词列表 (${words.length} 个单词)`;
      document.getElementById('startBtn').disabled = false;
      showMessage('可以直接开始测试示例单词，或上传自己的Excel文件', 'success');
    };
  </script>

</body>
</html>